Já temos um cluster criado no MongoDB Atlas, e agora precisamos aprender a nos conectar a ele. Como podemos fazer essa conexão usando o Python? Vamos entender isso.

Criando a Conexão do Cluster com o Python
Na tela inicial do MongoDB Atlas, desceremos um pouco a tela da seção "Database", e veremos uma seção com o nosso cluster, que chamamos de "Cluster-pipeline".

Logo à direita do nome do nosso cluster, temos uma opção chamada "Connect". Vamos clicar nela.

Na janela modal exibida, diversas opções são apresentadas para nos conectar ao nosso cluster. No nosso caso, podemos selecionar a opção "Drivers" na seção "Connect to your application", localizada no topo da janela. Com isso, vamos conectar a nossa aplicação ao nosso cluster.

Após o clique, iremos para a segunda tela de configuração. Nela, serão solicitadas mais algumas informações sobre o driver que vamos utilizar.

O driver será a ferramenta responsável por fazer a conexão com o Python e o MongoDB. Na primeira seção, "Select your driver and version" (Selecione seu driver e a versão), podemos clicar no botão de lista suspensa do campo "Driver" e selecionar o Python, que é a linguagem de programação que vamos usar.

No campo "Version", selecionaremos a versão desse driver que será responsável por conectar o Python ao MongoDB. Vamos clicar no botão de lista suspensa e selecionar a opção 3.12 or later (3.12 ou posterior), que é a versão mais recente no momento em que este vídeo está sendo gravado.

Contudo, pode ocorrer de já haver uma nova versão quando você estiver fazendo o curso. De qualquer forma, recomendamos que use a mesma versão utilizada no curso para que trabalhemos no mesmo ambiente e não haja tantos erros inesperados.

Descendo até a seção 2, "Install your driver" (Instale seu driver) é apresentado o comando que podemos usar para instalar o driver, que, nesse caso, é o PyMongo.

python -m pip install pymongo
Copiar código
PyMongo é uma biblioteca Python que nos permite trabalhar com o MongoDB no Python. Porém, não precisaremos executar esse comando, porque existem as atividades "Preparando o ambiente" nesta aula, onde instalamos todas as bibliotecas que vamos precisar usar em nosso projeto. A biblioteca PyMongo, neste momento, já está instalada, se você preparou os ambientes antes desse vídeo.

Seguindo para a seção 3, "Add your connection string into your application code" (Adicione sua string de conexão no seu código de aplicação), encontramos uma string de conexão que temos que usar para conectar o Python ao MongoDB.

mongodb+srv://millenagena: <password>@cluster-pipeline.rsooh5s.mongodb.net/? retryWrites=true&w=majority
Copiar código
Podemos conferir essa string aqui, mas, em cima dessa string, temos um botão de alternância chamado "View full code sample" (Visualizar amostra de código completa). Essa opção nos traz um código completo em Python, usando a biblioteca PyMongo, que podemos usar para fazer a conexão do Python com o MongoDB.

from pymongo.mongo_client import MongoClient
from pymongo.server_api import ServerApi

uri "mongodb+srv://millenagena: <password>@cluster-pipeline.rsooh5s.mongodb.net/? retryWrites=true&w=majority"

# Create a new client and connect to the server
client MongoClient (uri, server_api-ServerApi ('1'))

# Send a ping to confirm a successful connection
try:
    client.admin.command('ping')
    print("Pinged your deployment. You successfully connected to MongoDB!")
except Exception as e:
    print(e)
Copiar código
Podemos copiar esse código, clicando no ícone com duas folhas de papel, localizado à direita dele, denominado "copy" (copiar).

Agora, precisamos executar esse código. Para isso, vamos usar o nosso ambiente local. O ambiente local que vamos usar aqui é o Windows Subsystem for Linux (WSL), que é o Linux no Windows.

É muito importante que você já tenha o seu ambiente local todo configurado. Você consegue fazer isso realizando todas as atividades chamadas "Preparando Ambiente", disponibilizadas antes deste vídeo.

Nessas atividades, é possível configurar o WSL, criar um ambiente virtual Python (que também é importante), além de instalar e configurar o VS Code (editor de código que vamos utilizar) com o WSL. Caso ainda não tenha feito essas atividades, pause o vídeo, realize-as e, em seguida, retorne para este vídeo.

Vamos abrir o terminal do WSL. Faremos isso acessando a barra de pesquisa do sistema operacional e digitando "terminal", seguido pela tecla "Enter". Vamos acessar esse terminal e verificar que ele foi inicializado no Windows PowerShell.

Clicando na seta ao lado do nome da guia "Windows PowerShell", selecionaremos a opção "Ubuntu 22.04.2 LTS".

Depois disso, uma nova guia será carregada. Vamos maximizar a tela do terminal e aumentar o zoom para uma melhor visualização.

No interior dessa nova guia, vamos rodar o comando ls para listar as pastas existentes neste ambiente.

ls
Copiar código
Resposta do terminal:

pipeline-python-mongo-mysql

Entre elas, veremos que existe uma pasta chamada "pipeline-python-mongo-mysql". Essa é a pasta de trabalho onde desenvolveremos todo o nosso projeto no ambiente local. Você também a terá criada em seu ambiente, pois nas atividades de preparação do ambiente, nós ensinamos como fazer isso.

Acessaremos essa pasta com o comando cd seguido do nome da pasta e pressionando "Enter".

cd pipeline-python-mongo-mysql/
Copiar código
Agora, para abrir o VS Code diretamente dentro dessa pasta, podemos digitar code . (code seguido de espaço e ponto) e pressionar "Enter".

code .
Copiar código
Aguarde um momento enquanto o VS Code é aberto.

Após isso, o VS Code será inicializado. Se verificarmos na aba do "Explorer" (explorador), na lateral esquerda, temos uma pasta chamada "venv", referente ao ambiente virtual criado previamente, e uma outra pasta chamada "notebooks".

Dentro desta última, já existe um notebook chamado extract_and_save_data.ipynb. Esse notebook ainda não possui nenhum código, só tem alguns textos para estruturar o que iremos desenvolver em seu interior.

Vamos acessar o início desse notebook e fechar a aba do explorador. No interior desse notebook Python, podemos, na primeira célula de código, pressionar "Ctrl+V" para colar aquele código copiado do MongoDB Atlas. Vou dar um zoom para visualizarmos o código mais de perto.

Vamos entender rapidamente o que cada linha do código faz. As duas primeiras linhas importam algumas classes do PyMongo que serão necessárias para realizar a conexão com o nosso cluster no MongoDB Atlas.

Abaixo delas, temos a linha com a definição de uma variável chamada uri, que recebe a string de conexão necessária para realizar a autenticação e conexão com o nosso cluster.

Dentro dessa string de conexão estão inclusos o nosso nome de pessoa usuária (millenagena) e um espaço para a senha(<password>). Podemos substituir a palavra "password" e os símbolos de menor e maior pela nossa senha. No meu caso, a senha definida foi 12345.

Tome cuidado ao fazer essa substituição para não remover nenhum outro símbolo próximo ao espaço da senha.

Seguindo para a próxima linha, temos a definição de uma variável chamada client, que utiliza a classe MongoClient(), para a qual enviamos alguns parâmetros entre parênteses. O primeiro desses parâmetros é a uri, que é a nossa string de conexão.

Já o segundo parâmetro se chama server_api, onde passamos o número 1, que define a versão do servidor que estamos utilizando para realizar a conexão. Neste momento, estamos criando o nosso client, que é o nosso objeto de conexão com o MongoDB.

Para finalizar, temos o bloco try, no qual temos um client.admin.command() em cujo interior dos parênteses passamos o comando ping entre aspas simples. Este comando será utilizado como um teste de conectividade do Python com o MongoDB.

Se a conexão for bem-sucedida, ele imprimirá uma mensagem informando isso. Em caso de falha, ele lançará uma exceção, ou seja, um erro, e irá imprimir a informação de qual é esse erro.

Vamos executar o código nessa célula pressionando "Shift+Enter" e veremos o resultado.

Pinged your deployment. You successfully connected to MongoDB!

Ele retornou que conseguimos nos conectar ao MongoDB com sucesso. Portanto, podemos salvar nosso notebook pressionando "Ctrl+S".

Já conseguimos nos conectar com o MongoDB utilizando o Python. A seguir, podemos prosseguir para as próximas etapas do nosso pipeline.
