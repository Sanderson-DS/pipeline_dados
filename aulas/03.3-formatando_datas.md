Aplicamos a primeira transformação solicitada pela equipe de BI e constatamos que a coluna "Data da Compra" não apresenta dados estruturados no formato aceito por uma coluna do tipo DATE no MySQL. O desafio agora é identificar como podemos resolver este problema!

Formatando datas
Com o notebook transform_data.ipynb aberto na seção "Formatando as datas", vamos continuar utilizando a biblioteca Pandas para resolver a questão, uma vez que, atualmente, nossos dados de interesse estão contidos em um DataFrame.

Primeiramente, precisamos garantir que a coluna "Data da Compra" esteja no formato datetime do Pandas para que possamos manipulá-la. Vamos conferir isso ao pegar o DataFrame df_livros e chamar o método .info(). Este método retorna os tipos de cada coluna.

df_livros.info()
Copiar código
#	Column	Non-Null Count	Dtype
0	_id	742 non-null	object
1	Produto	742 non-null	object
2	Categoria do Produto	742 non-null	object
3	Preço	742 non-null	float64
4	Frete	742 non-null	float64
5	Data da Compra	742 non-null	object
6	Vendedor	742 non-null	object
7	Local da compra	742 non-null	object
8	Avaliação da compra	742 non-null	int64
9	Tipo de pagamento	742 non-null	object
10	Quantidade de parcelas	742 non-null	int64
11	Latitude	742 non-null	float64
12	Longitude	742 non-null	float64
Analisando "Data da Compra", verificamos que a coluna é do tipo object, ou seja, uma string. Logo, precisamos convertê-la para o tipo datetime. Para isso, temos o método to_datetime() da biblioteca Pandas, que executa exatamente esta tarefa.

Na célula seguinte, vamos selecionar a coluna de interesse. Para isso, chamamos df_livros e passamos o nome da coluna entre colchetes e aspas, ou seja, df_livros["Data da Compra"].

Isso será igual ao método pd.to_datetime(), recebendo como primeiro parâmetro a própria coluna que queremos converter, ou seja, df_livros["Data da Compra"].

O segundo parâmetro é o formato atual das datas na coluna, que é dia/mês/ano. Para isso, digitamos o parâmetro format e passamos %d/%m/%Y.

Feito isso, na próxima linha, vamos executar o método df_livros.info() para verificar se a coluna "Data da Compra" foi realmente alterada.

df_livros["Data da Compra"] = pd.to_datetime(df_livros["Data da Compra"], format="%d/%m/%Y")
df_livros.info()
Copiar código
Ao conferir o resultado, identificaremos na tabela a coluna "Data da Compra" definida com o tipo datetime64[ns]. Isso nos permite manipular o formato da data.

Agora, queremos alterar o formato atual dia/mês/ano para ano-mês-dia, que é o tipo de data aceito no MySQL. Na próxima célula, passaremos novamente o nome da coluna que vamos alterar (df_livros["Data da Compra"]), que será igual a df_livros["Data da Compra"].dt.strftime().

O método strftime() nos permite alterar o formato da data. Entre parênteses, passaremos entre aspas duplas o novo formato desejado para a data, que será %Y-%m-%d.

Na linha seguinte, vamos adicionar df_livros.head() para verificar se a transformação foi aplicada corretamente.

df_livros["Data da Compra"] = df_livros["Data da Compra"].dt.strftime("%Y-%m-%d")
df_livros.head()
Copiar código
_id	Produto	Categoria do Produto	Preço	Frete	Data da Compra	Vendedor	Local da compra	Avaliação da compra	Tipo de pagamento	Quantidade de parcelas	Latitude	Longitude
0	64b06481d1fe28f26c97417d	Modelagem preditiva	livros	92.45	5.609697	2020-01-01	Thiago Silva	BA	1	cartao_credito	3	-13.29	-41.71
1	64b06481d1fe28f26c97417e	Iniciando em programação	livros	43.84	0.000000	2020-01-01	Mariana Ferreira	SP	5	cartao_credito	1	-22.19	-48.79
2	64b06481d1fe28f26c974190	Iniciando em programação	livros	63.25	3.894137	2022-01-01	Juliana Costa	RJ	5	cartao_credito	4	-22.25	-42.66
3	64b06481d1fe28f26c97419e	Ciência de dados com python	livros	86.13	5.273176	2021-02-01	Camila Ribeiro	RJ	4	cartao_credito	3	-22.25	-42.66
4	64b06481d1fe28f26c9741a0	Ciência de dados com python	livros	72.75	1.458158	2021-02-01	Beatriz Moraes	PR	4	cartao_credito	2	-24.89	-51.55
Agora temos a data formatada como ano-mês-dia, exatamente como necessitamos. Então, podemos pegar o DataFrame df_livros e salvá-lo como CSV.

Para isso, vamos criar mais uma célula e chamar o método df_livros.to_csv(), pois vamos salvar nossos dados em um arquivo CSV. Porém, antes de salvá-lo, vamos criar uma pasta chamada "data" na aba "Explorer" à esquerda, onde armazenaremos os dados que precisamos salvar.

Então, vamos clicar no ícone "New Folder" (Nova Pasta), localizado logo à frente do nome da pasta atual, e criaremos a pasta "data". Feito isso, podemos fechar a aba "Explorer".

No método to_csv(), precisamos passamos o caminho do local onde desejamos salvar os dados em CSV. Para isso, abrimos e fechamos aspas. Como a pasta "data" que acabamos de criar está fora da pasta "notebooks", devemos indicar no caminho que precisamos voltar uma pasta para conseguir localizar a pasta "data".

Para fazer isso, podemos usar ../. Isso significa que será retornada uma pasta, pois atualmente estamos na pasta "notebooks", trabalhando no notebook transform_data.ipynb.

Após voltar uma pasta, podemos passar o nome da pasta "data", seguido do nome do arquivo desejado. Nesse caso, vamos definir como tabela_livros.csv.

Por último, vamos passar um parâmetro chamado index com o valor False, para não serem salvos os índices que o DataFrame costuma criar para cada coluna.

df_livros.to_csv('../data/tabela_livros.csv', index=False)
Copiar código
Após executar essa célula, ao abrir novamente a aba "Explorer", dentro da pasta "data", encontraremos o arquivo tabela_livros.csv.

Conclusão
Finalizamos mais uma etapa! Podemos salvar o notebook pressionando "Ctrl + S" e seguir para a próxima transformação solicitada pelo time de BI.
