Executamos a configuração do MongoDB Atlas, criamos um cluster e conectamos o Python a esse cluster do MongoDB, utilizando a biblioteca PyMongo.

Nosso próximo passo é criar um banco de dados no MongoDB para podermos armazenar os dados solicitados pela empresa e para que o time de Ciência de Dados (Data Science) tenha acesso a esses dados.

Criando o Banco de Dados no MongoDB
Anteriormente, deixamos o terminal com uma guia do Ubuntu no WSL aberta. Também acessamos a pasta "pipeline-python-mongo-mysql" por esse terminal.

Precisamos acessar o VS Code dentro dessa pasta. Para isso, podemos rodar o comando code ..

code .
Copiar código
Aguardamos um pouco até abrir o VS Code. Ele abriu e, inclusive, já abriu também uma guia com o interior do notebook extract_and_save_data.ipynb. Para confirmar que é o nosso notebook, vamos verificar na aba lateral do explorador. Após a conferência, podemos fechar essa aba.

Vamos acessar o interior do notebook e subir a tela até o início do código. Podemos observar que na primeira célula já temos o código que copiamos anteriormente do MongoDB Atlas. Como fechamos o VS Code e abrimos novamente, é muito importante executar esse código mais uma vez para garantir que a conexão seja feita.

Para isso, vamos selecionar essa célula e pressionar "Shift+Enter" para ser executada. Dessa forma, conseguimos nos conectar com sucesso ao cluster no MongoDB.

Resposta do notebook:

Pinged your deployment. You successfully connected to MongoDB!

Vamos descer a tela e prosseguir para a próxima sessão chamada "Criando Banco de Dados e uma Coleção". Para começar, vamos criar o nosso banco de dados. Para isso, vamos ter que utilizar o nosso objeto client, que está na variável client.

Para isso, vamos acessar a primeira célula dessa seção e vamos criar uma variável chamada db, de "Database", e vamos passar o client para ela. Nesse client, temos que passar o nome do banco de dados que desejamos criar. Para passar esse nome, temos que abrir e fechar colchetes ([]) e, entre aspas duplas, podemos passar o nome do banco de dados. Vamos chamá-lo de db_produtos.

db = client["db_produtos"]
Copiar código
Sabemos que um banco de dados no MongoDB é composto por coleções. Portanto, precisamos criar uma coleção para armazenar os dados. Para isso, vamos saltar uma linha, na qual criaremos uma variável chamada collection. Para essa variável, vamos passar o nosso objeto do banco de dados, ou seja, a nossa variável db.

Entre colchetes e aspas duplas, passaremos o nome da coleção. Vamos chamá-la de produtos.

db = client["db_produtos"]
collection = db["produtos"]
Copiar código
Vamos pressionar "Shift+Enter" para executar esse código.

Ele não retornará nenhum resultado, porque armazenamos tudo em variável. Com o código que rodamos, criamos o banco de dados e salvamos na variável db. Também criamos a coleção dentro do banco de dados db_produtos e a salvamos na variável collection.

Para verificar se esse banco de dados foi efetivamente criado, podemos ir para a próxima célula e digitar client.list_database_names(), que significa "listar os nomes das bases de dados".

client.list_database_names()
Copiar código
Executaremos essa célula, pressionando "Shift+Enter". Ele retornará informando que temos atualmente dois bancos de dados: admin e local, criados por padrão no MongoDB.

['admin', 'local']

Entretanto, podemos observar que nossa base de dados db_produtos não apareceu aqui. Isso acontece porque, no MongoDB, para uma base de dados e uma coleção serem efetivamente criadas, elas precisam ter pelo menos um documento, ou seja, pelo menos um dado. Logo, vamos criar um dado de exemplo para adicionarmos na nossa base de dados, permitindo que ela seja criada.

Fazemos isso na próxima célula, na qual vamos criar uma variável chamada product, de produto, para seguir o padrão que estamos aplicando com todas as variáveis em inglês. Ela receberá um dicionário, que é bem semelhante ao JSON e é um formato aceito pelo MongoDB.

Vamos começar abrindo e fechando colchetes ({}), no interior dos quais passaremos um campo chamado produto, entre aspas duplas, seguido de dois pontos. Em seguida, atribuiremos um valor a esse produto. Vamos adicionar o valor "computador". Como se trata apenas de um exemplo, não é relevante o valor que iremos atribuir.

Vamos adicionar mais um campo entre os colchetes, que nomearemos como "quantidade", e atribuiremos a ele o valor de 77, significando que temos uma quantidade de 77 computadores.

product = ["produto": "computador", "quantidade": 77}
Copiar código
Após isso, vamos saltar uma linha, na qual precisamos utilizar um comando para adicionar esse produto à nossa coleção produtos. Para isso, podemos chamar nossa variável collection, responsável pela conexão com a coleção produtos, seguida de .insert_one, que significa "inserir um".

Entre parênteses, passaremos o nome da nossa variável product, que é onde nosso documento de exemplo está armazenado. Faremos a cópia dela e colaremos entre os parênteses.

product = {"produto": "computador", "quantidade": 77}
collection.insert_one(product)
Copiar código
Executando essa célula, ele retornará um objeto do tipo InsertOneResult, o que significa que a operação foi bem sucedida, visto que nenhum erro foi retornado.

<pymongo.results. InsertOneResult at 0x7efef3983700>

Para garantir que esse documento foi realmente inserido, podemos acessar a próxima célula e utilizar um comando chamado find_one(). Para isso, chamaremos nossa coleção collection e adicionaremos a ela um .find_one().

Esse comando retorna o primeiro documento que temos na coleção, que, nesse caso, é o único que temos até o momento.

collection.find_one()
Copiar código
Executando a célula, vemos que ele retornou o documento que inserimos, que está armazenado na variável product. Como resultado, temos o produto computador e a quantidade 77.

{'_id': ObjectId('64c8ffe2a97dcd30e1a3b412'),

'produto': 'computador',

'quantidade': 77}

No entanto, percebe-se que ele também retornou mais um campo, o _id. Isso acontece porque sempre que adicionamos um dado no MongoDB, por padrão, ele cria um ID para cada documento adicionado.

Para verificar se a base de dados foi criada com sucesso, podemos acessar a próxima célula, copiar e rodar o comando client.list_database_names() executado anteriormente.

client.list_database_names()
Copiar código
Executando a célula, vemos que nosso banco de dados db_produtos aparece na lista de bancos de dados.

['db_produtos', 'admin', 'local']

Com isso feito, podemos salvar nosso notebook pressionando "Ctrl+S". Não devemos esquecer de salvá-lo regularmente.

Com o banco de dados criado, podemos adicionar os dados referentes aos produtos vendidos pela empresa de e-commerce.
